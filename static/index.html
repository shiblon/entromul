<!DOCTYPE "html">
<html>
  <head>
    <script src="js/jquery.min.js"></script>
    <script src="js/jcanvas.min.js"></script>
    <script src="js/lodash.min.js"></script>
    <script src="js/gameloop.js"></script>
    <script src="js/multiplication-drill.js"></script>
    <script>
      $(function() {
        function makeDrill() {
          var numProblems = +$('#_drillsize').val();
          alert(numProblems);
          var drill = new MultiplicationDrill('_canvas', {
            numProblems: numProblems,
            onfinished: function(correct, wrong, elapsed, paused) {
              console.log('FINISHED');
              console.log('correct', correct);
              console.log('wrong', wrong);
              console.log('elapsed', elapsed);
              console.log('paused', paused);

              var wrongStrs = [];
              for (var i = 0; i < wrong.length; i++) {
                var w = wrong[i],
                    m1 = w[0],
                    m2 = w[1],
                    a = w[2];
                wrongStrs.push(
                    '<li>' + m1 + ' \u00D7 ' + m2 + ' = ' +
                    (m1 * m2) + '    - you wrote ' + a + '</li>');
              }

              var wrongOutput = '';
              if (wrongStrs.length > 0) {
                wrongOutput = 'Wrong answers:<ul>' + wrongStrs.join('\n') + '</ul>';
              }

              var stats = $('#_stats');
              stats[0].innerHTML = stats[0].innerHTML
              .replace(/%correct%/, correct.length)
              .replace(/%total%/, correct.length + wrong.length)
              .replace(/%elapsed%/, elapsed)
              .replace(/%paused%/, paused)
              .replace(/%wrongAnswers%/, wrongOutput);
              stats.show();
            },
          });
          return drill;
        }

        function startDrill() {
          $('#_instructions').hide();
          var drill = makeDrill();
          drill.start();
        }
        $('#_stats').hide();
        window.startDrill = startDrill;
      });
    </script>
    <style>
      #_canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <div id="_game">
      <canvas id="_canvas" width="640" height="480"></canvas>
    </div>
    <div id="_instructions">
      Do <select id="_drillsize" name="drillsize">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select> problems.
      <input type="button" onclick="startDrill();" value="Start"></input>
    </div>
    <div id="_stats">
      You got <b>%correct%</b> correct out of <b>%total%</b>.<br>
      It took you <b>%elapsed%</b> to complete these problems.<br>
      You paused <b>%paused%</b> times.<br>
      %wrongAnswers%<br>
    </div>
  </body>
</html>
